name: pull-request-main

on:
  merge_group:
  pull_request:
    branches:
      - main

jobs:
  ci-lint:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout repo (needed to reference local action)
        uses: actions/checkout@8ade135a41bc03ea155e62e844d188df1ea18608 # v4.1.0

      - name: ci-lint
        uses: ./actions/ci-lint-ts
        with:
          # general inputs
          checkout-repo: "false"
          # grafana inputs
          metrics-job-name: ci-lint
          gc-basic-auth: ${{ secrets.GRAFANA_CLOUD_BASIC_AUTH }}
          gc-host: ${{ secrets.GRAFANA_CLOUD_HOST }}

  ci-lint-misc:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout repo (needed to reference local action)
        uses: actions/checkout@8ade135a41bc03ea155e62e844d188df1ea18608 # v4.1.0

      - name: ci-lint-misc
        uses: ./actions/ci-lint-misc
        with:
          # general inputs
          checkout-repo: "false"
          # grafana inputs
          metrics-job-name: ci-lint-misc
          gc-basic-auth: ${{ secrets.GRAFANA_CLOUD_BASIC_AUTH }}
          gc-host: ${{ secrets.GRAFANA_CLOUD_HOST }}

  ci-test:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout repo (needed to reference local action)
        uses: actions/checkout@8ade135a41bc03ea155e62e844d188df1ea18608 # v4.1.0

      - name: ci-test
        uses: ./actions/ci-test-ts
        with:
          # general inputs
          checkout-repo: "false"
          # grafana inputs
          metrics-job-name: ci-test
          gc-basic-auth: ${{ secrets.GRAFANA_CLOUD_BASIC_AUTH }}
          gc-host: ${{ secrets.GRAFANA_CLOUD_HOST }}

  ci-build-artifacts:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout repo (needed to reference local action)
        uses: actions/checkout@8ade135a41bc03ea155e62e844d188df1ea18608 # v4.1.0

      - name: ci-build-artifacts
        uses: ./actions/cicd-build-publish-artifacts-ts
        with:
          # general inputs
          checkout-repo: "false"
          # grafana inputs
          metrics-job-name: ci-build-artifacts
          gc-basic-auth: ${{ secrets.GRAFANA_CLOUD_BASIC_AUTH }}
          gc-host: ${{ secrets.GRAFANA_CLOUD_HOST }}
